---
name: ""
attributes: null
---

# 在庫取引

在庫の増減を記録する取引情報を管理するエンティティ。在庫の履歴と監査証跡を提供する。

## 属性

### 取引ID

在庫取引を一意に識別するための識別子。

- システム内で自動生成される一意の識別子であること
- 変更不可であること

### 取引日時

在庫取引が発生した日時。

- 有効な日時形式であること
- 入力必須であること
- デフォルトは現在日時

### 取引タイプ

在庫取引の種類を示すコード。

- 「入庫」「出庫」「移動」「調整」「棚卸」などの定められた値の中から選択すること
- 入力必須であること

### 商品ID

取引対象の商品の識別子。

- 商品エンティティに存在するIDであること
- 入力必須であること

### 倉庫ID（元）

取引元の倉庫の識別子。

- 倉庫エンティティに存在するIDであること
- 出庫、移動の場合は入力必須
- 入庫のみの場合はnull可

### 倉庫ID（先）

取引先の倉庫の識別子。

- 倉庫エンティティに存在するIDであること
- 入庫、移動の場合は入力必須
- 出庫のみの場合はnull可

### 数量

取引数量。

- 0より大きい数値であること
- 入力必須であること
- 小数点以下の単位を許容する商品と許容しない商品がある

### 単価

取引時の単価。

- 0以上の数値であること
- 入力は任意であること
- 小数点以下2桁まで許容すること

### 取引理由

取引が発生した理由や関連する注文番号など。

- 255文字以内であること
- 入力は任意であること

### 取引先ID

取引に関連する取引先の識別子。

- 取引先エンティティに存在するIDであるか、nullであること
- 入力は任意であること

### 参照ドキュメント

取引に関連する外部ドキュメント（発注書、納品書など）の参照情報。

- 255文字以内であること
- 入力は任意であること

### 担当者ID

取引を実行したユーザーの識別子。

- ユーザーエンティティに存在するIDであること
- 入力必須であること

### メモ

取引に関する補足情報。

- 1000文字以内であること
- 入力は任意であること

### 作成日時

取引記録が作成された日時。

- システムによって自動設定されること
- 変更不可であること

## ビジネスルール

- 在庫取引は作成後に変更や削除ができない（不変性）
- 誤った取引を修正するには、逆の取引を新たに作成する必要がある
- 出庫時には、対象倉庫の在庫数量が取引数量以上であることを確認する
- 移動取引の場合、元倉庫と先倉庫が異なることを確認する
- 在庫取引の発生時に、関連する在庫エンティティの数量を自動的に更新する
- 取引タイプに応じた適切な倉庫IDの組み合わせを確認する（例：出庫の場合は元倉庫IDが必須）
